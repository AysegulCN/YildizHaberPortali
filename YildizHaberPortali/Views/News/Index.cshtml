@model IEnumerable<YildizHaberPortali.Models.News>
@{
    ViewData["Title"] = "Haber Yönetimi";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    /* --- TARZ 2: HABER LİSTESİ --- */
    .premium-card {
        border-radius: 20px;
        border: none;
    }

    .premium-table {
        border-collapse: separate;
        border-spacing: 0 12px;
    }

        .premium-table tr {
            background: #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border-radius: 15px;
            transition: 0.3s;
        }

            .premium-table tr:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(78,115,223,0.1);
            }

        .premium-table td, .premium-table th {
            border: none !important;
            padding: 15px !important;
            vertical-align: middle !important;
        }

    .btn-round {
        border-radius: 50px;
        font-weight: 600;
        padding: 8px 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-4 px-3">
    <h3 class="font-weight-bold text-gray-800 m-0"><i class="fas fa-newspaper text-primary mr-2"></i>Haber Listesi</h3>
    <a asp-action="Create" class="btn btn-primary btn-round shadow">
        <i class="fas fa-plus mr-2"></i>Yeni Haber Yayınla
    </a>
</div>

<div class="card premium-card shadow-sm mx-2">
    <div class="card-body bg-light" style="border-radius: 20px;">
        <div class="table-responsive">
            <table class="table premium-table">
                <thead>
                    <tr class="text-muted small text-uppercase font-weight-bold">
                        <th width="100">Görsel</th>
                        <th>Haber Başlığı</th>
                        <th class="text-center">Durum</th>
                        <th class="text-center">İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                <img src="~/uploads/@item.Image" class="rounded shadow-sm" style="width:70px; height:50px; object-fit:cover;" />
                            </td>
                            <td>
                                <div class="font-weight-bold text-dark">@item.Title</div>
                                <div class="small text-primary">@item.Category?.Name</div>
                            </td>
                            <td class="text-center">
                                <i class="fas fa-circle @(item.IsPublished ? "text-success" : "text-secondary") small mr-1"></i>
                                <span class="font-weight-bold">@(item.IsPublished ? "Yayında" : "Pasif")</span>
                            </td>
                            <td class="text-center">
                                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning btn-round btn-sm text-white mr-1 shadow-sm">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-round btn-sm shadow-sm">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(document).ready(function () {
            // SİLME İŞLEMİ (Sayfa yenilenmeden)
            $(document).on('click', '.btn-delete', function () {
                var btn = $(this);
                var id = btn.data("id");
                var row = btn.closest("tr");

                if (confirm("Bu haberi silmek istediğinizden emin misiniz?")) {
                    $.ajax({
                        url: '/News/Delete/' + id,
                        type: 'POST',
                        success: function (res) {
                            if (res.success) {
                                row.fadeOut(500, function() { $(this).remove(); });
                            } else {
                                alert("Hata: " + res.message);
                            }
                        },
                        error: function() {
                            alert("Silme işlemi başarısız oldu.");
                        }
                    });
                }
            });

            // DURUM (YAYINDA/PASİF) SWITCH ÇALIŞTIRMA
            $('.chk-status').change(function () {
                var id = $(this).data("id");
                var label = $(this).next('label');
                var isChecked = $(this).is(':checked');

                $.post("/News/ToggleStatus", { id: id }, function (res) {
                    if (res.success) {
                        label.text(isChecked ? "Yayında" : "Pasif");
                    }
                });
            });
        });
    </script>
}