@model IEnumerable<YildizHaberPortali.Models.News>
@{
    ViewData["Title"] = "Haber Yönetimi";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    /* --- TARZ 2: HABER LİSTESİ --- */
    .premium-card {
        border-radius: 20px;
        border: none;
    }

    .premium-table {
        border-collapse: separate;
        border-spacing: 0 12px;
    }

        .premium-table tr {
            background: #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border-radius: 15px;
            transition: 0.3s;
        }

            .premium-table tr:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(78,115,223,0.1);
            }

        .premium-table td, .premium-table th {
            border: none !important;
            padding: 15px !important;
            vertical-align: middle !important;
        }

    .btn-round {
        border-radius: 50px;
        font-weight: 600;
        padding: 8px 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
</style>

@* Views/News/Index.cshtml *@

<div class="container-fluid py-4">
    <div class="card shadow border-0" style="border-radius: 25px; overflow: hidden;">
        <div class="card-header bg-white py-4 px-5 d-flex justify-content-between align-items-center border-bottom-0">
            <h4 class="m-0 font-weight-bold text-dark"><i class="fas fa-list text-primary mr-3"></i> Haber Listesi</h4>
            <a href="/News/Create" class="btn btn-primary rounded-pill px-4 shadow-sm font-weight-bold">
                <i class="fas fa-plus mr-2"></i> Yeni Haber Yayınla
            </a>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-muted small text-uppercase">
                        <tr>
                            <th class="border-0 px-5 py-4">GÖRSEL</th>
                            <th class="border-0 py-4">HABER BAŞLIĞI</th>
                            <th class="border-0 py-4">KATEGORİ</th> @* 🚀 İSTEDİĞİN SÜTUN *@
                            <th class="border-0 py-4">YAZAR</th>
                            <th class="border-0 py-4 text-center">DURUM</th>
                            <th class="border-0 py-4 text-center">İŞLEMLER</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td class="px-5">
                                    <img src="~/uploads/@item.Image" class="rounded shadow-sm border" 
                                         style="width: 60px; height: 40px; object-fit: cover;" 
                                         onerror="this.src='/img/no-image.png'">
                                </td>
                                <td class="font-weight-bold text-dark">@item.Title</td>
                                
                                @* 🚀 Kategori Rozeti *@
                                <td>
                                    <span class="badge badge-light-primary text-primary rounded-pill px-3 py-2 border" style="background-color: rgba(78, 115, 223, 0.05); border: 1px solid rgba(78,115,223,0.1) !important;">
                                        <i class="fas fa-tag mr-1 small"></i> @(item.Category?.Name ?? "Genel")
                                    </span>
                                </td>

                                <td class="text-muted small"><i class="far fa-user mr-1"></i> @item.Author</td>

                                <td class="text-center">
                                    @if (item.IsPublished)
                                    {
                                        <span class="text-success font-weight-bold"><i class="fas fa-check-circle mr-1"></i> Yayında</span>
                                    }
                                    else
                                    {
                                        <span class="text-danger font-weight-bold"><i class="fas fa-pause-circle mr-1"></i> Taslak</span>
                                    }
                                </td>

                                <td class="text-center">
                                    <a href="/News/Edit/@item.Id" class="btn btn-warning btn-sm rounded-circle shadow-sm mr-2" title="Düzenle">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button onclick="deleteNews(@item.Id)" class="btn btn-danger btn-sm rounded-circle shadow-sm" title="Sil">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



@section Scripts {
    <script>
        $(document).ready(function () {
            // SİLME İŞLEMİ (Sayfa yenilenmeden)
            $(document).on('click', '.btn-delete', function () {
                var btn = $(this);
                var id = btn.data("id");
                var row = btn.closest("tr");

                if (confirm("Bu haberi silmek istediğinizden emin misiniz?")) {
                    $.ajax({
                        url: '/News/Delete/' + id,
                        type: 'POST',
                        success: function (res) {
                            if (res.success) {
                                row.fadeOut(500, function() { $(this).remove(); });
                            } else {
                                alert("Hata: " + res.message);
                            }
                        },
                        error: function() {
                            alert("Silme işlemi başarısız oldu.");
                        }
                    });
                }
            });

            // DURUM (YAYINDA/PASİF) SWITCH ÇALIŞTIRMA
            $('.chk-status').change(function () {
                var id = $(this).data("id");
                var label = $(this).next('label');
                var isChecked = $(this).is(':checked');

                $.post("/News/ToggleStatus", { id: id }, function (res) {
                    if (res.success) {
                        label.text(isChecked ? "Yayında" : "Pasif");
                    }
                });
            });
        });
    </script>
}